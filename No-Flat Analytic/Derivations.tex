\documentclass[a4paper]{article}
\usepackage{amsmath}

\begin{document}

\section{Non-Flat Mutation Rates INITIAL}

\begin{align*}
\bar{r} \dot{x}_i & = u_{i} r_{i-1} x_{i-1} + x_{i} ( r_I ( 1- u_{i+1} ) - \bar{r} ) \\
r & = \text{const.} \\
\dot{\rho _i} & = u_i \rho _{i-1} - \rho _{i} u_{i+1} \\
\dot{\rho} (x, t) & = u(x) \rho (x - \Delta x, t) - \rho (x,t) u(x + \Delta x , t) \\
& = u(x) \left( \rho (x) - \Delta x \frac{\partial \rho}{\partial x} + \Delta x ^2 \frac{\partial ^2 \rho}{\partial x ^ 2} \right) - \rho (x, t) \left( u(x) + \Delta x \frac{\partial u}{\partial x} + \Delta x ^2 \frac{\partial ^2 u }{\partial x ^2} \right) \\
\Delta x & = 1 \\
\dot{\rho} (x, t) & = - u \frac{\partial \rho}{\partial x} + u \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left( \frac{\partial u}{\partial x} + \frac{\partial ^2 u}{\partial x ^2} \right) \\
\end{align*}

Collecting up some terms. 

\begin{align*}
\dot{\rho} & = - \frac{\partial}{\partial x} ( \rho u ) + u \frac{\partial ^2 \rho}{\partial x ^2} - \rho \frac{\partial ^2 u}{\partial x ^2}
\end{align*}

Fourier transform convention 

\begin{equation}
\tilde{\rho} = \int _{- \infty} ^{\infty} \rho e ^{-ikx } dx 
\end{equation}

\begin{align*}
\dot{\tilde{\rho}} & = - \int \frac{\partial}{\partial x} (\rho u) e^{-ikx} dx + \int u \frac{\partial ^2 \rho}{\partial x^2} e^{-ikx} dx - \int \rho \frac{\partial ^2 u}{\partial x ^2 } e^{-ikx} dx
\end{align*}

\begin{align*}
\int \frac{\partial}{\partial x} (\rho u) e^{-ikx} dx & = \left[ e^{-ikx} \rho u \right] _{-\infty} ^{\infty} - \int (-ik) \rho u e^{-ikx} dx \\
& = ik \int \rho u e^{-ikx} dx
\end{align*}

Applying the convolution theorem:

\begin{align*}
F(f \cdot g ) & = F(f) * F(g) \\
f*g & = \frac{1}{\sqrt{2 \pi}} \int _{- \infty} ^ {\infty} g(y) f(x-y) dy \\
\end{align*}

Need to prove these. 

Applying this to the new differential equation. 

\begin{align*}
\dot{\tilde{\rho}} & = - ik ( \mathcal{F} (\rho ) * \mathcal{F} ( u) ) + ( \mathcal{F} (u) * \mathcal{F} ( \frac{\partial ^2 \rho}{\partial x ^2} ) ) - ( \mathcal{F} ( \rho ) * \mathcal{F} ( \frac{\partial ^2 u}{\partial x ^2} ) )
\end{align*}

Using what we know for the differentials and Fourier bits. 

\begin{align*}
\dot{\tilde{\rho}} & = -ik \left( \tilde{\rho} * \tilde{u} \right) + \left( \tilde{u} * (-k ^2 ) \tilde{\rho} \right) - \left( \tilde{\rho} * (-k ^2 ) \tilde{u} \right)
\end{align*}

We can take out the factors of $k^2$. 

\begin{align*}
\dot{\tilde{\rho}} & = -ik ( \tilde{\rho} * \tilde{u} ) -k ^2 \left( ( \tilde{u} * \tilde{\rho} ) + ( \tilde{\rho} * \tilde{u} ) \right) \\
& = ( -ik  - 2 k^2 ) ( \tilde{\rho} * \tilde{u} )
\end{align*}

Convolution is commutative. 

Chose a simple $u = \cos(\frac{\pi}{2 M} x ) $. 

\begin{align*}
\tilde{u} & = \int \cos(\frac{\pi}{2 M} x ) e^{-ikx} dx \\
& = \frac{1}{2} \int ( e^{\frac{i \pi}{2 M} x} + e^{ - \frac{i \pi}{2 M} x} ) e^{-ikx} ) dx \\
& = \frac{1}{2} \left( \delta ( k - \frac{\pi}{2 M} ) + \delta ( k + \frac{\pi}{2 M} \right)
\end{align*}

Convolution of a delta function just returns the same function with the varaible shifted. 

\begin{equation}
f(x) * \delta (x \pm a)  = f(x \pm a)  
\end{equation}

\begin{align*}
\tilde{\rho} * \tilde{u} & = \tilde{\rho} * \frac{1}{2} \left( \delta ( k - \frac{\pi}{2 M} ) + \delta ( k + \frac{\pi}{2 M} \right) \\
& = \frac{1}{2} \left( \tilde{\rho} ( k - \frac{\pi}{2 M} ) + \tilde{\rho} ( k + \frac{\pi}{2 M} ) \right)
\end{align*}

Combining everything in one. 

\begin{align*}
\dot{\tilde{\rho}} & = - \frac{(ik + k ^2 )}{2}  \left( \tilde{\rho} ( k - \frac{\pi}{2 M} ) + \tilde{\rho} ( k + \frac{\pi}{2 M} ) \right) 
\end{align*}

\newpage

\subsection*{Improved}

\begin{align*}
\dot{\rho} & = u \rho(x - \Delta x) - \rho u(x + \Delta x) \\
& = u \left( \rho (x) - \Delta x \frac{\partial \rho}{\partial x} + \frac{\Delta x ^2}{2} \frac{\partial ^2 \rho}{\partial x^2} \right) - \rho \left( u(x) + \Delta x \frac{\partial u }{\partial x} + \frac{\Delta x ^2}{2} \frac{\partial ^2 u}{\partial x ^2} \right) \\ 
& = - u \frac{\partial \rho}{\partial x} \Delta x + u \frac{\Delta x ^2}{2} \frac{\partial ^2 \rho}{\partial x ^2} - \Delta x \rho \frac{\partial u}{\partial x} - \frac{\Delta x ^2}{2} \rho \frac{\partial ^2 u}{\partial x ^2}
\end{align*}
Introduce a new scaled variable $\hat{u} = u(x) \cdot \Delta x$. 

\begin{align*}
\dot{\rho} & = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x}{2} \hat{u} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \frac{\partial \hat{u}}{\partial x} - \frac{\Delta x }{2} \rho \frac{\partial ^2 \hat{u}}{\partial x ^2}
\end{align*}

This collapses down into our old equation with an additional term. 

\begin{align*}
\dot{\rho} & = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x}{2} \hat{u} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) 
\end{align*}

In the limit $\Delta x \rightarrow 0$ we get the normal advection equation 

\begin{equation}
\lim _{\Delta x \rightarrow 0} \dot{\rho}  = - \frac{\partial (\rho \hat{u} )}{\partial x}
\end{equation}

\newpage

\section{Numerically Solving the PDE}

Start with the PDE and initial condition. 

\begin{equation}
\dot{\rho} = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x}{2} \hat{u} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) 
\end{equation}

\begin{equation}
\rho ( x, 0) = \delta (x - x _0 ) 
\end{equation}

We discretise with $x_i = i h $ and $t_j = jk$. 

\begin{align*}
\frac{\partial \rho}{\partial t} & = \frac{\rho ( x_i , t_{j+1}) - \rho (x _i , t_j )}{k} \\
\frac{\partial \rho}{\partial x} & = \frac{\rho ( x_{i + 1} , t_{}) - \rho (x _i , t_j )}{h} \\
\frac{\partial ^2 \rho}{\partial x ^2} & = \frac{\rho (x_{i+1} , t_j ) - 2 \rho ( x _i, t _j ) + \rho (x_{i-1} , t_j ) }{h ^2} \\
\end{align*}

Inserting these into the PDE

\begin{align*}
\frac{\rho ( x_i , t_{j+1}) - \rho (x _i , t_j )}{k} & = - \hat{u} \left(  \frac{\rho ( x_{i + 1} , t_{j}) - \rho (x _i , t_j )}{h} \right) + \frac{\hat{u} \Delta x}{2} \left( \frac{\rho (x_{i+1} , t_j ) - 2 \rho ( x _i, t _j ) + \rho (x_{i-1} , t_j ) }{h ^2} \right)  \\
& - \rho ( x _i , t_j ) f( \hat{u} ' , \hat{u} '' , \Delta x ) \\
f( \hat{u} ' , \hat{u} '' , \Delta x ) & = \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) 
\end{align*}

\begin{align*}
\rho ( x_i , t_{j+1}) & = \rho - \frac{\hat{u} k }{h} \left( \rho (x_{i+1} , t_j ) - \rho \right) + \frac{\hat{u} \Delta x k }{2 h ^2} \left( \rho ( x_{i + 1 }, t_j ) - 2 \rho + \rho ( x_{i-1} , t_j ) \right) - k \rho f \\
& = \rho \left( 1 + \frac{\hat{u } k }{h} - \frac{\hat{u} \Delta x k }{h^2} - kf \right) + \frac{\hat{u} \Delta x k }{2 h ^2} \rho ( x_{i-1} , t_j )  + \rho ( x_{i+1} , t_j ) \left( \frac{\hat{u} \Delta x k}{ 2 h ^2} - \frac{\hat{u} k}{h} \right) \\
& = \rho \left(1 + \frac{\hat{u} k }{h} \left(1 - \frac{\Delta x}{h} \right) - k \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right)  \right) + \frac{\hat{u} \Delta x k }{2 h ^2} \rho ( x_{i-1} , t_j ) + \rho ( x_{i+1} , t_j ) \left( \frac{\Delta x }{2h} - 1 \right) \frac{\hat{u} k }{h}
\end{align*}

Can then solve this the normal computational way.

\newpage

\section{PDE Analysis}

\begin{equation}
\dot{\rho} = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x}{2} \hat{u} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) 
\end{equation}

Re-arrange this to the stardard form. 

\begin{align*}
\frac{\Delta x \hat{u}}{2} \frac{\partial ^2 \rho }{\partial x ^2} - \hat{u} \frac{\partial \rho}{\partial x} - \frac{\partial \rho}{\partial t} - \rho \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) & = 0 
\end{align*}

Classification of this PDE is based on the coeffeicents of the double derivatives. 

\begin{align*}
\Delta (x , y) & = 0 ^2 - 0^ 2 = 0
\end{align*}

As there are know terms with the cross derivative and no terms with the second differential of $t$, the determinate is zero and the equation is parabolic. 
 
\newpage 
 
\section{Mutation Function analysis}

We are free to chose a function for the mutation rate. 

\begin{equation}
\dot{\rho} = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x}{2} \hat{u} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left( \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x }{2} \frac{\partial ^2 \hat{u}}{\partial x^2} \right) 
\end{equation}

The degree of freedom comes in the last term, so we define a function for ease of notation. 

\begin{equation}
\mathcal{U} (x, \hat{u}, \hat{u} ^{(n)} ) = \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 \hat{u}}{\partial x^2}
\end{equation}

\subsection{$\mathcal{U} = \hat{u}$}

By setting the function equal to the mutation function then it can be taken as a common factor from all the terms in the PDE. 

\begin{align*}
 \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 \hat{u}}{\partial x^2} & = \hat{u} \\ 
\end{align*}

$\hat{u}$ is just a function of $x$, therefore this is a linear, second order differential equation with auxillary equation; 

\begin{align*}
\lambda & = \frac{- 1 \pm \sqrt{1 + 2 \Delta x}}{\Delta x},
\end{align*}

therefore, is has solutions 

\begin{align*}
\hat{u} & = A \exp \left( \left( - \frac{1}{\Delta x} + \frac{\sqrt{1 + 2 \Delta x}}{\Delta x} \right) x \right) + B \exp \left( - \left( \frac{1}{\Delta x} + \frac{\sqrt{1 + 2 \Delta x}}{\Delta x} \right) x \right)
\end{align*}

$A$ and $B$ are constants that determine the scale of mutation probabilities. 

\subsection{$\mathcal{U} = \text{polynomial}$ }

\begin{align*}
 \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 \hat{u}}{\partial x^2} & = \sum _{- \infty} ^{\infty} c_n x^n \\ 
\end{align*}

\begin{align*}
v & = \frac{\partial \hat{u}}{\partial x} \\
v + \frac{\Delta x }{2} \frac{\partial v}{\partial x} & =  \sum _{- \infty} ^{\infty} c_n x^n
\end{align*}

This has complimentary function (correct phrase?) 

\begin{align*}
v & = B e^{- \frac{2}{\Delta x} x}
\end{align*}

Trial form for the particular integral;

\begin{align*}
v(x) & = B e^{- \frac{2}{\Delta x} x} + \sum c_{\alpha } x^{\alpha } \\
v ' & = \frac{-2 B}{\Delta x} e^{- \frac{2}{\Delta x} x} + \sum \alpha c_{\alpha} x^{\alpha - 1} \\
\end{align*}
\begin{align*}
B e^{- \frac{2}{\Delta x} x} + \sum c_{\alpha } x^{\alpha } + \frac{\Delta x}{2} \left( \frac{-2 B}{\Delta x} e^{- \frac{2}{\Delta x} x} + \sum \alpha c_{\alpha} x^{\alpha - 1} \right) & = \sum _{- \infty} ^{\infty} c_n x^n \\
\sum c_{\alpha } x^{\alpha } + \frac{\Delta x}{2} \sum  \alpha c_{\alpha } x^{\alpha -1 } & = \sum _{- \infty} ^{\infty} c_n x^n \\
\sum c_{\alpha } x^{\alpha } + \frac{\Delta x}{2} \sum ( \alpha + 1 ) c_{\alpha + 1} x ^{\alpha } & = \sum _{- \infty} ^{\infty} c_n x^n
\end{align*}

From orthogonality of the powers

\begin{align*}
c_{\alpha } + \frac{\Delta x}{2} ( \alpha + 1 ) c_{\alpha + 1 } & = c _n
\end{align*}

OR 

\begin{align*}
c _\alpha + \frac{\Delta x }{2} \frac{\alpha c_\alpha }{x} & = c_n \\
c_\alpha & = \frac{c_n}{1 + \frac{\Delta x \alpha }{2x}}
\end{align*}

So the full solution is 

\begin{align*}
v ( x) & = B e^{\frac{-2 x}{\Delta x} } + \sum \frac{c_n x ^n }{1 + \frac{\Delta x n}{2 x}} 
\end{align*}

Unwinding the substitution 

\begin{align*}
\frac{\partial \hat{u}}{\partial x } & = B e^{\frac{-2 x}{\Delta x} } + \sum \frac{c_n x ^n }{1 + \frac{\Delta x n}{2 x}} \\
\hat{u} & =  - \frac{B \Delta x}{2} e^{\frac{-2 x}{\Delta x} } + \int \sum	 \frac{2 c_n x^{n+1}}{2x + \Delta x n } \mathrm{d} x
\end{align*}

\subsubsection*{Testing by differentiation and subbing back in. }

\begin{align*}
\hat{u} & =  - \frac{B \Delta x}{2} e^{\frac{-2 x}{\Delta x} } + \int \sum	 \frac{2 c_n x^{n+1}}{2x + \Delta x n } \mathrm{d} x \\
\hat{u} ' & = B e ^{- \frac{2x}{\Delta x }} + \sum	 \frac{2 c_n x^{n+1}}{2x + \Delta x n } \\
\hat{u} '' & = \frac{- 2 B }{\Delta x} e ^{- \frac{2x}{\Delta x }} + \sum \left( \frac{2 c_n (n+1) x^n}{(2x + \Delta x n)} - \frac{4 c_n x^{n+1}}{(2 x + \Delta x n )^2}  \right) \\
\hat{u} ' + \frac{\Delta x}{2} \hat{u} '' & = \sum	 \frac{2 c_n x^{n+1}}{2x + \Delta x n } + \frac{\Delta x}{2} \left( \sum \left( \frac{2 c_n (n+1) x^n}{(2x + \Delta x n)} - \frac{4 c_n x^{n+1}}{(2 x + \Delta x n )^2}  \right) \right) \\
\end{align*}

In the limit of $\Delta x \rightarrow 0$ this is correct. 

\subsubsection*{Example}

\begin{align*}
 \frac{\partial \hat{u}}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 \hat{u}}{\partial x^2} & = \sum _{- \infty} ^{\infty} c_n x^n \\ 
 \sum _{- \infty} ^{\infty} c_n x^n & = x \\
 c_n & =  \begin{cases}
1 & n = 1 \\
0 & n \neq 1		
\end{cases} \\
\hat{u} & =  - \frac{B \Delta x}{2} e^{\frac{-2 x}{\Delta x} } + \int \sum	 \frac{2 c_n x^{n+1}}{2x + \Delta x n } \mathrm{d} x \\
& = - \frac{B \Delta x}{2} e^{\frac{-2 x}{\Delta x} } + \int \left( \frac{2 x^2}{2 x + \Delta x} \right)
\end{align*}

\newpage

\subsection{FKKP Methods}

"Wave of Advance of Advantageous Genes" Ronald Fisher. 

\begin{align*}
\dot{\rho} & = - \hat{u} \frac{\partial \rho}{\partial x} + \frac{\Delta x \hat{u}}{2} \frac{\partial ^2 \rho}{\partial x ^2} - \rho \left(\frac{\partial u}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 u}{\partial x ^2} \right) \\
\end{align*}

We want a wave solution, travelling at speed $v$, therefore $ \frac{\partial \rho}{\partial t}  = - v \frac{\partial \rho}{\partial x}$ 

\begin{equation}
\frac{\Delta x \hat{u}}{2} \rho ^{''} + ( v - \hat{u} ) \rho ^{'} - \rho \left( u^{'} + \frac{\Delta x}{2} u^{''} \right) = 0 
\end{equation} 

There is no explicit $x$ dependence in the equation, therefore we can write the concentration as the derivative of another function. 

\begin{align*}
g & = - \frac{d \rho}{d x} \\
\frac{\partial g}{\partial x} & = - \frac{\partial ^2 \rho}{\partial x ^2 } \\
\frac{\partial ^2 \rho}{\partial x^2} &= g \frac{\partial g}{\partial \rho} \\
\end{align*}

\begin{equation}
\frac{\Delta x \hat{u}}{2} g \frac{\partial g}{\partial \rho} + ( v - \hat{u} ) (-g) - \rho \left( \frac{\partial u}{\partial x} + \frac{\Delta x}{2} \frac{\partial ^2 u}{\partial x ^2 } \right)  = 0 
\end{equation}

$$\lim _{\rho \rightarrow 0} \frac{g}{\rho} = \omega $$
$$ \frac{\partial g}{\partial \rho} = \omega $$

\begin{equation}
\frac{\hat{u} \Delta x }{2} \omega ^2 + ( v - \hat{u} ) ( - \omega ) - \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u}'' \right) = 0 
\end{equation}

By examining the determinant of this quadratic equation we can arrive at an equation for $v$. 

\begin{align*}
(v - \hat{u} )^2 - 4 \frac{\hat{u} \Delta x}{2} \left( - \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u}'' \right) \right) & \geq 0 \\
v ^2   - 2 v \hat{u} + \hat{u} ^2 + 2 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u} '' \right) & \geq 0 \\
v ^2   - 2 v \hat{u} + \hat{u} ^2 + 2 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u} '' \right) & = C \\
C &  \geq 0 \\
\end{align*}

\begin{align*}
v ^2   - 2 v \hat{u} + \hat{u} ^2 + 2 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u} '' \right) - C & = 0 \\
v & = 2 \hat{u} \pm \sqrt{4 \hat{u} ^ 2 - 4 \left( \hat{u} ^2 + 2 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u} '' \right) - C \right) }\\
&= 2 \hat{u} \pm \sqrt{-8 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x \hat{u} ''}{2 } \right) + 4 C}
\end{align*}

As the velocity is a physical quantity, this gives us some constraints on the function inside the square brackets. 


\begin{equation}
C - 2 \hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x}{2} \hat{u} '' \right)  \geq 0 
\end{equation}

This gives us an ODE for $\hat{u}$: 

\begin{align*}
\hat{u} \Delta x \left( \hat{u} ' + \frac{\Delta x }{2} \hat{u} '' \right) + D & = 0
\end{align*}

Where $D$ is just the redefining of the constant. 

This is very non linear and doesn't have an analytic solution. 

NEED TO SOLVE IT NUMERICALLY.


\end{document}